<!DOCTYPE html>
<html>
    <head>
        <style>
            svg{
                border: solid 4px black;
            }
        </style>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.2/d3.js"></script>
        <script>
            var data;
            window.onload = function(){
                drawSvg();
            }
            drawSvg = function(){
                d3.select("#svg").selectAll("*").remove();
                var svgWidth = 600, svgHeight = 400;
                var margin = { top: 20, right: 20, bottom: 30, left: 50 };
                var width = svgWidth - margin.left - margin.right;
                var height = svgHeight - margin.top - margin.bottom;

                var svg = d3.select('#svg')
                    .attr("width", svgWidth)
                    .attr("height", svgHeight);
                
                parseDate = d3.timeParse("%Y-%m");

                data = {
                    series: [
                        {name:"Test1", values:[1,2,3]},
                        {name:"Test2", values:[3,2,1]},
                        {name:"Test3", values:[1,1,1]},
                        {name:"Test4", values:[2,2,2]}
                    ],
                    //x: [0,1,2],
                    xLabels: ['2018-12','2019-01','2019-02']
                };
                //data.x = data.x.map(d3.timeParse("%Y-%m"))

                var color = d3.scaleOrdinal()
                    .domain(Array.from(Array(data.xLabels.length).keys()))
                    .range(d3.schemeCategory10);

                //var x = d3.scaleTime()
                //    .domain(d3.extent(data.x)).nice()
                var x = d3.scaleLinear()
                    .domain([0,data.xLabels.length-1])
                    .range([margin.left, width - margin.right])

                var y = d3.scaleLinear()
                    .domain([0, d3.max(data.series, d => d3.max(d.values))]).nice()
                    .range([height - margin.bottom, margin.top])

                var line = d3.line()
                    .defined(d => !isNaN(d))
                    .x((d, i) => x(i))
                    .y(d => y(d))

                path = svg.append("g")
                        .attr("fill", "none")
                        
                        .attr("stroke-width", 1.5)
                        .attr("stroke-linejoin", "round")
                        .attr("stroke-linecap", "round")
                    .selectAll("path")
                    .data(data.series)
                        .join("path")
                        .style("mix-blend-mode", "multiply")
                        .attr("d", d => line(d.values))
                        .attr("stroke", (d,i) => color(i));

                yAxis = svg.append("g")
                .attr("transform", `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(x)
                    .tickValues(Array.from(Array(data.xLabels.length).keys()))
	                .tickFormat(function (d) {
		                return data.xLabels[d];
	            }))
                    .selectAll("text")
                        .attr("transform", "rotate(70)")
                        .attr("x", 10)
                        .attr("y", 0)
                        .style("text-anchor", "start");
                
                xAxis = svg.append("g")
                .attr("transform", `translate(${margin.left},0)`)
                    .call(d3.axisLeft(y))
                    
                hover = function(svg, path){
                    if ("ontouchstart" in document) svg
                        .on("touchmove", moved)
                        .on("touchstart", entered)
                        .on("touchend", left)
                    else svg
                        .on("mousemove", moved)
                        .on("mouseenter", entered)
                        .on("mouseleave", left);

                    dot = svg.append("g")
                        .attr("display", "none");

                    dot.append("circle")
                        .attr("r", 2.5);

                    dot.append("text")
                        .style("font", "10px sans-serif")
                        .attr("text-anchor", "middle")
                        .attr("y", -8);

                    function moved() {
                        d3.event.preventDefault();

                        ym = y.invert(d3.event.layerY);
                        xm = x.invert(d3.event.layerX);
                        i1 = d3.bisectLeft(Array.from(Array(data.xLabels.length).keys()), xm, 1);
                        i0 = i1 - 1;
                        i = xm - i0 > i1 - xm ? i1 : i0;
                        s = data.series.reduce((a, b) => Math.abs(a.values[i] - ym) < Math.abs(b.values[i] - ym) ? a : b);

                        path.attr("stroke-opacity", d => d === s ? null : 0.2).filter(d => d === s).raise();
                        dot.attr("transform", `translate(${x(i)},${y(s.values[i])})`);
                        dot.select("text").text(s.name + " (" + s.values[i] + ")");
                    }

                    function entered() {
                        path.style("mix-blend-mode", null).attr("stroke-opacity", 0.2);
                        dot.attr("display", null);
                    }

                    function left() {
                        path.style("mix-blend-mode", "multiply").attr("stroke-opacity", 1);
                        dot.attr("display", "none");
                    }
                }
                
                svg.call(hover, path);
            };
        </script>
    </head>
    <body>
        <svg id="svg" width="500" height="500">
            
        </svg>
    </body>
</html>